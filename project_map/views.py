import json
from django.template.loader import render_to_string
from django.views.decorators.csrf import csrf_exempt
from django.shortcuts import render
from django.http import response

from project_map.forms import FromTravelingForm, ToTravelingForm
from project_map.models import Rayon, Project, Category, RayonCategory, RayonSubCategory, CompletePhoto, Rubric
from formtools.wizard.views import SessionWizardView

def ProjectsView(request):
    #form = RegionForm
    ob_list = []
    rayons = Rayon.objects.all().order_by('title')
    c_list = Category.objects.filter(active = True).order_by('count').values()
    projects_to_map = Project.objects.filter(category__active = True)
    complete_projects_count = projects_to_map.filter(complete = True).count()
    complete_main_photo_ob = None
    complete_main_photo = CompletePhoto.objects.values('project__id').distinct()
    complete_main_photo_ob = projects_to_map.filter(complete = True).filter(on_main=True).filter(id__in = complete_main_photo)
    for item in c_list:
        ob_list.append({'category_id': item['id'], 'category_title': item['title'], 'category_color': item['color'], 'c_img': item['category_icon'], 'objects_cout': projects_to_map.filter(category__id = item['id']).count()})
    return render(request, 'projects.html', {'regions': rayons, 'c_list': c_list, 'ob_list': ob_list, 'complete_main_photo_ob': complete_main_photo_ob, 'projects_to_map': projects_to_map, 'complete_projects_count': complete_projects_count})

@csrf_exempt
def RayonApiView(request):
    rayon_list = {}
    selected_rayon = None
    r_c_list = {}
    c_list = {}
    c_color = {}
    c_img = {}
    c_count = {}
    ob_list = {}
    r_list = {}
    complete_projects_count = Project.objects.filter(rayon__id=request.GET.get('id')).filter(category__active = True).filter(complete=True).count()
    if request.method == 'GET':
        selected_rayon = Rayon.objects.filter(id=request.GET.get('id')).first()
        select_rayon = Rayon()
        if selected_rayon:
            select_rayon = selected_rayon
            for c in RayonCategory.objects.filter(rayon = selected_rayon):

                rayon_sub_category = {}
                for sc in RayonSubCategory.objects.filter(rayon_category = c):
                    sub = {}
                    sub_cat = [('category_name', sc.category_name), ('objects_count', sc.objects_count), ('investments', sc.investments)  ]
                    sub.update(sub_cat)
                    rayon_sub_category.update({'sc'+str(sc.id): sub})
                rayon_cat = {}
                rayon_category = [('category_name', c.category_name), ('objects_count', c.objects_count), ('investments', c.investments) , ('rayon_sub_category', rayon_sub_category) ]
                rayon_cat.update(rayon_category)
                r_c_list.update({'c'+str(c.id): rayon_cat})
            for i in Project.objects.filter(rayon__id=request.GET.get('id')).filter(category__active = True).order_by('category__count'):
                proj = {}
                proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                             ('color', i.category.color)]
                proj.update(proj_list)
                ob_list.update({i.id: proj})
                c_list.update({i.category.id: i.category.title})
                c_color.update({i.category.id: i.category.color})
                if i.category.category_icon:
                    c_img.update({i.category.id: i.category.category_icon.url})
                else:
                    c_img.update({i.category.id: 'None'})
                c_count.update({i.category.id: Project.objects.filter(rayon__id=request.GET.get('id')).filter(
                    category__id=i.category.id).count()})
        else:
            for c in RayonCategory.objects.all():

                rayon_sub_category = {}
                for sc in RayonSubCategory.objects.filter(rayon_category=c):
                    sub = {}
                    sub_cat = [('category_name', sc.category_name), ('objects_count', sc.objects_count),
                               ('investments', sc.investments)]
                    sub.update(sub_cat)
                    rayon_sub_category.update({'sc' + str(sc.id): sub})
                rayon_cat = {}
                rayon_category = [('category_name', c.category_name), ('objects_count', c.objects_count),
                                  ('investments', c.investments), ('rayon_sub_category', rayon_sub_category)]
                rayon_cat.update(rayon_category)
                r_c_list.update({'c' + str(c.id): rayon_cat})

            for i in Project.objects.filter(category__active = True).order_by('category__count'):
                proj={}
                proj_list =[('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker), ('color', i.category.color)]
                proj.update(proj_list)
                ob_list.update({i.id: proj})
                c_list.update({i.category.id: i.category.title})
                c_color.update({i.category.id: i.category.color})
                c_img.update({i.category.id: i.category.category_icon.url})
                c_count.update({i.category.id: Project.objects.filter(rayon__id = request.GET.get('id')).filter(category__id = i.category.id).count()})
        if select_rayon.infografika_im:
            infografika_im = select_rayon.infografika_im.url
        else:
            infografika_im = None
        if select_rayon.mobile_infografika_im:
            mobile_infografika_im = select_rayon.mobile_infografika_im.url
        else:
            mobile_infografika_im = None
        default_coords = json.dumps([[[[58.476819, 30.717256], [58.479321999999996, 30.717965], [58.481337999999994, 30.726853], [58.482389999999995, 30.747809999999998], [58.504281999999996, 30.775219], [58.513675, 30.794238], [58.518791, 30.787437999999998], [58.529671, 30.804903999999997], [58.528589999999994, 30.814114999999997], [58.534482999999994, 30.830405], [58.543819, 30.82174], [58.548047999999994, 30.82713], [58.566523999999994, 30.824499999999997], [58.566432, 30.834075], [58.568887, 30.833762], [58.571296, 30.866196], [58.580568, 30.864504], [58.579983, 30.874879999999997], [58.604855, 30.869954], [58.607392999999995, 30.877992], [58.613341999999996, 30.87343], [58.619236, 30.883805], [58.62247, 30.89817], [58.628268999999996, 30.898873], [58.638816, 30.929420999999998], [58.645877, 30.939863], [58.639697, 30.940053], [58.63227, 30.931652], [58.643361, 30.974207999999997], [58.660396, 30.975873999999997], [58.679711, 31.001692], [58.679854999999996, 31.007483999999998], [58.683350999999995, 31.014933], [58.692868999999995, 31.015317999999997], [58.715906, 31.057011], [58.722680999999994, 31.039416], [58.730461, 31.043450999999997], [58.729419, 31.005239999999997], [58.725752, 30.998306999999997], [58.727695, 30.986748], [58.737486999999994, 31.006321999999997], [58.745749999999994, 30.990674], [58.743817, 30.981268], [58.742095, 30.981900999999997], [58.736962999999996, 30.969168], [58.73179, 30.965108999999998], [58.727995, 30.970623999999997], [58.724517999999996, 30.954228999999998], [58.716794, 30.93582], [58.708141999999995, 30.928451], [58.703903999999994, 30.917861], [58.706596, 30.908095999999997], [58.711994999999995, 30.903931], [58.723366, 30.913425999999998], [58.732333999999994, 30.929803], [58.744479, 30.910809999999998], [58.753355, 30.920876], [58.754976, 30.919877], [58.755221999999996, 30.914603999999997], [58.752624, 30.908765], [58.757531, 30.911023999999998], [58.758998, 30.900292], [58.756301, 30.86414], [58.749466999999996, 30.855767999999998], [58.744209, 30.843667999999997], [58.737235999999996, 30.838661], [58.727996999999995, 30.837661999999998], [58.737356, 30.813799999999997], [58.756299999999996, 30.805827999999998], [58.775425, 30.818931], [58.786137, 30.80856], [58.780519, 30.790533], [58.791433999999995, 30.775413], [58.796623, 30.778069], [58.800453, 30.769309999999997], [58.808142999999994, 30.776632], [58.810699, 30.765304999999998], [58.817533999999995, 30.773608], [58.837734, 30.773923], [58.852509, 30.763071], [58.855093, 30.768113999999997], [58.856655999999994, 30.762522999999998], [58.865790999999994, 30.765964999999998], [58.873712999999995, 30.773698999999997], [58.878173, 30.791864999999998], [58.876413, 30.794456999999998], [58.876579, 30.813316], [58.902885999999995, 30.872491999999998], [58.920815, 30.920842999999998], [58.942989, 30.95235], [58.964012999999994, 30.965609999999998], [58.973662, 30.954655], [58.980916, 30.979893999999998], [58.989422, 30.980075], [58.999765999999994, 31.006331999999997], [59.015741, 30.972284], [59.015701, 30.956722], [59.032554999999995, 30.956761999999998], [59.034796, 30.967475], [59.031844, 30.971863], [59.04405, 30.972704999999998], [59.044089, 30.984561999999997], [59.040687999999996, 30.991329], [59.057955, 31.015185], [59.068166, 31.022333999999997], [59.072917999999994, 31.042008], [59.077155, 31.050124999999998], [59.075191, 31.057612], [59.072339, 31.053268], [59.069281, 31.062706], [59.074380999999995, 31.071066], [59.090872999999995, 31.083081999999997], [59.089932, 31.131482], [59.078925, 31.153084], [59.075807999999995, 31.166840999999998], [59.069266, 31.164502], [59.062089, 31.167645999999998], [59.054956999999995, 31.156768], [59.054505999999996, 31.165834], [59.050267, 31.175680999999997], [59.04683, 31.166752], [59.046943, 31.190707], [58.969232, 31.25366], [58.969668, 31.275717], [58.972773, 31.293412999999997], [58.970755999999994, 31.313678], [58.962207, 31.304136], [58.952631999999994, 31.323301999999998], [58.942403999999996, 31.321633], [58.933518, 31.315098], [58.925484, 31.315623], [58.911685999999996, 31.297212], [58.860648999999995, 31.458512], [58.852069, 31.473674], [58.853851, 31.49544], [58.850328999999995, 31.495573], [58.852000999999994, 31.508371], [58.846962, 31.525508], [58.850618999999995, 31.529854], [58.846618, 31.539468999999997], [58.841077, 31.53596], [58.845912999999996, 31.554143999999997], [58.83734, 31.583375999999998], [58.839214, 31.599731], [58.831441999999996, 31.631138999999997], [58.838044, 31.647291], [58.845501, 31.653585], [58.836639999999996, 31.683982999999998], [58.840529999999994, 31.688266], [58.835153, 31.705789999999997], [58.836164999999994, 31.715144], [58.828947, 31.740364], [58.826539, 31.743416], [58.824569999999994, 31.741342999999997], [58.805129, 31.807260999999997], [58.838525999999995, 31.843217], [58.795562, 31.98742], [58.78736, 31.978471], [58.779303999999996, 32.00446], [58.714563, 31.943361999999997], [58.714093999999996, 31.931669999999997], [58.628389999999996, 31.923074999999997], [58.626638, 31.942396], [58.631190999999994, 31.945335999999998], [58.630617, 31.956142999999997], [58.638748, 31.963293], [58.636435, 31.974621], [58.633559, 31.975202999999997], [58.632031, 31.983038999999998], [58.632664, 31.998874999999998], [58.629965999999996, 32.000943], [58.630497999999996, 32.010811], [58.627700999999995, 32.010456999999995], [58.630078, 32.016106], [58.629273999999995, 32.024198], [58.630635999999996, 32.028692], [58.626126, 32.039837999999996], [58.628192999999996, 32.051214], [58.634451, 32.046032], [58.642722, 32.058706], [58.640544999999996, 32.064645], [58.637105999999996, 32.057542999999995], [58.620061, 32.061088999999996], [58.618282, 32.070723], [58.623835, 32.086636999999996], [58.622015999999995, 32.097093], [58.620110999999994, 32.096759999999996], [58.619498, 32.091218999999995], [58.605323999999996, 32.096049], [58.602014999999994, 32.083062], [58.603069, 32.070879999999995], [58.592751, 32.072452999999996], [58.584633999999994, 32.065143], [58.587238, 32.047817], [58.593323, 32.047772], [58.597621, 32.034023], [58.599709, 32.034286], [58.599042, 32.030042], [58.606078, 32.007048], [58.606556, 32.000073], [58.598828, 32.004267999999996], [58.596675, 32.02039], [58.587553, 32.026767], [58.573453, 32.023252], [58.569133, 32.037991999999996], [58.561854, 32.037709], [58.550711, 32.04425], [58.542977, 32.038739], [58.51604, 32.063725999999996], [58.510304, 32.035286], [58.497144999999996, 32.016138], [58.492706, 32.014793], [58.478738, 31.952557], [58.479262999999996, 31.933940999999997], [58.435534, 31.934556999999998], [58.435865, 31.95021], [58.438337, 31.952544999999997], [58.437593, 31.958938999999997], [58.430025, 31.955164999999997], [58.428568999999996, 31.932475999999998], [58.422593, 31.934123999999997], [58.425894, 31.921955999999998], [58.421141999999996, 31.919802999999998], [58.419528, 31.931917], [58.411004, 31.93923], [58.411196999999994, 31.932246], [58.417486999999994, 31.921702], [58.417763, 31.916866], [58.383435, 31.929961], [58.382618, 31.936936], [58.370526, 31.93665], [58.370264, 31.90044], [58.359404, 31.900634999999998], [58.351226, 31.881805], [58.338449999999995, 31.882872], [58.337813999999995, 31.880004999999997], [58.335089999999994, 31.881573], [58.32939, 31.897588], [58.326069, 31.894026999999998], [58.328413, 31.886419], [58.331744, 31.885247], [58.331945, 31.876409], [58.327484, 31.876842], [58.332043, 31.854559], [58.314012999999996, 31.847061], [58.310280999999996, 31.864514], [58.295514999999995, 31.860948999999998], [58.291464999999995, 31.846096], [58.292418999999995, 31.816187], [58.282843, 31.812237999999997], [58.282740999999994, 31.781768999999997], [58.27533, 31.779014], [58.276574, 31.772146999999997], [58.274245, 31.750003], [58.268356, 31.764281999999998], [58.267495, 31.781104], [58.262420999999996, 31.775722], [58.256902999999994, 31.781440999999997], [58.253864, 31.765576], [58.253175, 31.742023], [58.250826999999994, 31.747041], [58.245069, 31.749754], [58.238986, 31.775592999999997], [58.236675999999996, 31.774375], [58.232875, 31.75408], [58.239512999999995, 31.737022999999997], [58.239644999999996, 31.724942], [58.233492999999996, 31.714622], [58.225575, 31.715771999999998], [58.22228, 31.702317999999998], [58.218453999999994, 31.699779999999997], [58.217008, 31.687448999999997], [58.216345, 31.571368], [58.250080999999994, 31.56048], [58.250257, 31.021313], [58.279410999999996, 30.954579], [58.283035, 30.940458], [58.280379999999994, 30.938149], [58.289893, 30.898484], [58.261804999999995, 30.851174999999998], [58.258261999999995, 30.848885], [58.265936999999994, 30.843574], [58.268138, 30.839107], [58.267249, 30.837093], [58.273002999999996, 30.830068999999998], [58.28416, 30.806739], [58.291948, 30.81995], [58.289142, 30.780209], [58.299689, 30.780153], [58.299796, 30.761322], [58.311499, 30.759964999999998], [58.311572, 30.773393], [58.347879, 30.769546], [58.348788, 30.805135], [58.444624, 30.7959], [58.444378, 30.776797], [58.442012, 30.772857], [58.439763, 30.77668], [58.436929, 30.773740999999998], [58.42896, 30.759750999999998], [58.431611, 30.756645], [58.420756999999995, 30.719285], [58.42577, 30.692331], [58.438663999999996, 30.701024], [58.434076999999995, 30.718843999999997], [58.437163999999996, 30.727794], [58.455037999999995, 30.749845999999998], [58.453758, 30.759483], [58.458704, 30.769771], [58.461379, 30.768472], [58.467087, 30.752055], [58.472435999999995, 30.753678999999998]], [[58.529311, 31.200588], [58.524550999999995, 31.209118], [58.522498, 31.205983], [58.521567, 31.212557], [58.51904, 31.209933999999997], [58.518950999999994, 31.220329999999997], [58.516701999999995, 31.220178999999998], [58.516433, 31.223615], [58.512062, 31.219519], [58.512283, 31.212542], [58.509876999999996, 31.212276], [58.508928, 31.219613], [58.506608, 31.221404999999997], [58.499347, 31.219689], [58.497505999999994, 31.237030999999998], [58.486048, 31.231222], [58.486833, 31.237320999999998], [58.491693999999995, 31.241905], [58.491265999999996, 31.249820999999997], [58.493378, 31.252447999999998], [58.491001999999995, 31.266078999999998], [58.486925, 31.261363999999997], [58.485429999999994, 31.269226999999997], [58.489675, 31.273671], [58.488454999999995, 31.280959], [58.482633, 31.272996], [58.478412999999996, 31.273312999999998], [58.476912, 31.268642], [58.473842, 31.273024999999997], [58.471084, 31.270069999999997], [58.472047999999994, 31.277006], [58.481327, 31.281781], [58.48674, 31.291182], [58.492202, 31.293001], [58.491375999999995, 31.301136999999997], [58.497657999999994, 31.297888999999998], [58.497522999999994, 31.294272999999997], [58.503467, 31.294009], [58.509164, 31.310447], [58.507697, 31.319481999999997], [58.513326, 31.327866], [58.516529999999996, 31.340063999999998], [58.52547, 31.331569], [58.533122999999996, 31.340377], [58.533485999999996, 31.326715999999998], [58.537079999999996, 31.328495999999998], [58.539820999999996, 31.324341999999998], [58.557685, 31.327403999999998], [58.562234999999994, 31.320159999999998], [58.563922999999996, 31.312678], [58.569131, 31.316336], [58.567403999999996, 31.344063], [58.57228, 31.342485], [58.573882, 31.348057999999998], [58.583059, 31.342793], [58.584365999999996, 31.345086], [58.592492, 31.394766999999998], [58.599239, 31.412501], [58.612727, 31.407251], [58.623943, 31.413929999999997], [58.627792, 31.422242999999998], [58.631029999999996, 31.421115999999998], [58.629304, 31.416923999999998], [58.631077999999995, 31.414299999999997], [58.626877, 31.40889], [58.636488, 31.401719999999997], [58.639322, 31.393642999999997], [58.645368, 31.399697999999997], [58.650749999999995, 31.386329], [58.642410999999996, 31.378213], [58.643935, 31.372455], [58.638828999999994, 31.367742999999997], [58.640480999999994, 31.362333999999997], [58.636098999999994, 31.357643], [58.63122, 31.366819999999997], [58.613284, 31.35482], [58.611931999999996, 31.356796], [58.612829, 31.362306], [58.608200999999994, 31.376209], [58.60622, 31.373413999999997], [58.603054, 31.377921999999998], [58.605751, 31.385773999999998], [58.603102, 31.388744], [58.605914999999996, 31.392369], [58.600167, 31.404536999999998], [58.59442, 31.392875999999998], [58.594136999999996, 31.382337999999997], [58.589335999999996, 31.365845], [58.591542, 31.358621999999997], [58.589071, 31.350331999999998], [58.592127999999995, 31.347029], [58.587052, 31.335193], [58.587469, 31.326375], [58.590492999999995, 31.321586], [58.588604, 31.318672], [58.589608999999996, 31.313965999999997], [58.577647, 31.297884], [58.579507, 31.290083], [58.587427999999996, 31.286305], [58.590092999999996, 31.263579999999997], [58.599261999999996, 31.257196999999998], [58.619170999999994, 31.272544999999997], [58.61814, 31.280078], [58.624105, 31.283756999999998], [58.630537, 31.25638], [58.630266999999996, 31.250847999999998], [58.632937999999996, 31.248444], [58.634726, 31.255969], [58.637753999999994, 31.252238], [58.636514999999996, 31.246104], [58.640845, 31.242455999999997], [58.633648, 31.209159999999997], [58.623723, 31.212868999999998], [58.621727, 31.205938999999997], [58.579102999999996, 31.241781], [58.572576999999995, 31.238626], [58.568768999999996, 31.241445], [58.562059999999995, 31.234209], [58.559399, 31.244443999999998], [58.555943, 31.245195], [58.550801, 31.240208], [58.554604999999995, 31.226512999999997], [58.553061, 31.226793999999998], [58.551990999999994, 31.221728], [58.545807999999994, 31.215138999999997], [58.537499999999994, 31.215373999999997], [58.536538, 31.198348]]]])
        r_list = {'id': select_rayon.id, 'title': select_rayon.title, 'full_objects_count': select_rayon.full_objects_count, 'complete_projects_count': complete_projects_count, 'infografika_im': infografika_im, 'mobile_infografika_im': mobile_infografika_im, 'full_investments': select_rayon.full_investments, 'gerb_im': select_rayon.gerb_im.url if select_rayon.gerb_im else '/static/img/gerb.png' , 'coords': select_rayon.coords if selected_rayon else default_coords, 'c_list': c_list, 'r_c_list': r_c_list, 'c_color': c_color, 'c_img': c_img, 'c_count':c_count, 'ob_list': ob_list }

    return response.JsonResponse(r_list)

@csrf_exempt
def Projects_listView(request):
    projects_list = {}
    p_list = {}
    p_adr_list = {}
    mark_list = {}
    p_id = {}
    ob_list = {}
    complete_projects_count = 0
    r_coords = None
    if request.method == 'GET':
        if request.GET.get('r_id') != '0':
            if request.GET.get('c_id') !='0':
                complete_projects_count = Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__id = request.GET.get('c_id')).filter(complete=True).count()
                for i in Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__id = request.GET.get('c_id')):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = Rayon.objects.get(id = request.GET.get('r_id')).coords
            else:
                complete_projects_count = Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__active = True).filter(complete=True).count()
                for i in Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__active = True):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = Rayon.objects.get(id = request.GET.get('r_id')).coords
        else:
            if request.GET.get('c_id') != '0':
                complete_projects_count = Project.objects.filter(category__id = request.GET.get('c_id')).filter(complete=True).count()
                for i in Project.objects.filter(category__id = request.GET.get('c_id')):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = json.dumps([[[[58.476819, 30.717256], [58.479321999999996, 30.717965], [58.481337999999994, 30.726853], [58.482389999999995, 30.747809999999998], [58.504281999999996, 30.775219], [58.513675, 30.794238], [58.518791, 30.787437999999998], [58.529671, 30.804903999999997], [58.528589999999994, 30.814114999999997], [58.534482999999994, 30.830405], [58.543819, 30.82174], [58.548047999999994, 30.82713], [58.566523999999994, 30.824499999999997], [58.566432, 30.834075], [58.568887, 30.833762], [58.571296, 30.866196], [58.580568, 30.864504], [58.579983, 30.874879999999997], [58.604855, 30.869954], [58.607392999999995, 30.877992], [58.613341999999996, 30.87343], [58.619236, 30.883805], [58.62247, 30.89817], [58.628268999999996, 30.898873], [58.638816, 30.929420999999998], [58.645877, 30.939863], [58.639697, 30.940053], [58.63227, 30.931652], [58.643361, 30.974207999999997], [58.660396, 30.975873999999997], [58.679711, 31.001692], [58.679854999999996, 31.007483999999998], [58.683350999999995, 31.014933], [58.692868999999995, 31.015317999999997], [58.715906, 31.057011], [58.722680999999994, 31.039416], [58.730461, 31.043450999999997], [58.729419, 31.005239999999997], [58.725752, 30.998306999999997], [58.727695, 30.986748], [58.737486999999994, 31.006321999999997], [58.745749999999994, 30.990674], [58.743817, 30.981268], [58.742095, 30.981900999999997], [58.736962999999996, 30.969168], [58.73179, 30.965108999999998], [58.727995, 30.970623999999997], [58.724517999999996, 30.954228999999998], [58.716794, 30.93582], [58.708141999999995, 30.928451], [58.703903999999994, 30.917861], [58.706596, 30.908095999999997], [58.711994999999995, 30.903931], [58.723366, 30.913425999999998], [58.732333999999994, 30.929803], [58.744479, 30.910809999999998], [58.753355, 30.920876], [58.754976, 30.919877], [58.755221999999996, 30.914603999999997], [58.752624, 30.908765], [58.757531, 30.911023999999998], [58.758998, 30.900292], [58.756301, 30.86414], [58.749466999999996, 30.855767999999998], [58.744209, 30.843667999999997], [58.737235999999996, 30.838661], [58.727996999999995, 30.837661999999998], [58.737356, 30.813799999999997], [58.756299999999996, 30.805827999999998], [58.775425, 30.818931], [58.786137, 30.80856], [58.780519, 30.790533], [58.791433999999995, 30.775413], [58.796623, 30.778069], [58.800453, 30.769309999999997], [58.808142999999994, 30.776632], [58.810699, 30.765304999999998], [58.817533999999995, 30.773608], [58.837734, 30.773923], [58.852509, 30.763071], [58.855093, 30.768113999999997], [58.856655999999994, 30.762522999999998], [58.865790999999994, 30.765964999999998], [58.873712999999995, 30.773698999999997], [58.878173, 30.791864999999998], [58.876413, 30.794456999999998], [58.876579, 30.813316], [58.902885999999995, 30.872491999999998], [58.920815, 30.920842999999998], [58.942989, 30.95235], [58.964012999999994, 30.965609999999998], [58.973662, 30.954655], [58.980916, 30.979893999999998], [58.989422, 30.980075], [58.999765999999994, 31.006331999999997], [59.015741, 30.972284], [59.015701, 30.956722], [59.032554999999995, 30.956761999999998], [59.034796, 30.967475], [59.031844, 30.971863], [59.04405, 30.972704999999998], [59.044089, 30.984561999999997], [59.040687999999996, 30.991329], [59.057955, 31.015185], [59.068166, 31.022333999999997], [59.072917999999994, 31.042008], [59.077155, 31.050124999999998], [59.075191, 31.057612], [59.072339, 31.053268], [59.069281, 31.062706], [59.074380999999995, 31.071066], [59.090872999999995, 31.083081999999997], [59.089932, 31.131482], [59.078925, 31.153084], [59.075807999999995, 31.166840999999998], [59.069266, 31.164502], [59.062089, 31.167645999999998], [59.054956999999995, 31.156768], [59.054505999999996, 31.165834], [59.050267, 31.175680999999997], [59.04683, 31.166752], [59.046943, 31.190707], [58.969232, 31.25366], [58.969668, 31.275717], [58.972773, 31.293412999999997], [58.970755999999994, 31.313678], [58.962207, 31.304136], [58.952631999999994, 31.323301999999998], [58.942403999999996, 31.321633], [58.933518, 31.315098], [58.925484, 31.315623], [58.911685999999996, 31.297212], [58.860648999999995, 31.458512], [58.852069, 31.473674], [58.853851, 31.49544], [58.850328999999995, 31.495573], [58.852000999999994, 31.508371], [58.846962, 31.525508], [58.850618999999995, 31.529854], [58.846618, 31.539468999999997], [58.841077, 31.53596], [58.845912999999996, 31.554143999999997], [58.83734, 31.583375999999998], [58.839214, 31.599731], [58.831441999999996, 31.631138999999997], [58.838044, 31.647291], [58.845501, 31.653585], [58.836639999999996, 31.683982999999998], [58.840529999999994, 31.688266], [58.835153, 31.705789999999997], [58.836164999999994, 31.715144], [58.828947, 31.740364], [58.826539, 31.743416], [58.824569999999994, 31.741342999999997], [58.805129, 31.807260999999997], [58.838525999999995, 31.843217], [58.795562, 31.98742], [58.78736, 31.978471], [58.779303999999996, 32.00446], [58.714563, 31.943361999999997], [58.714093999999996, 31.931669999999997], [58.628389999999996, 31.923074999999997], [58.626638, 31.942396], [58.631190999999994, 31.945335999999998], [58.630617, 31.956142999999997], [58.638748, 31.963293], [58.636435, 31.974621], [58.633559, 31.975202999999997], [58.632031, 31.983038999999998], [58.632664, 31.998874999999998], [58.629965999999996, 32.000943], [58.630497999999996, 32.010811], [58.627700999999995, 32.010456999999995], [58.630078, 32.016106], [58.629273999999995, 32.024198], [58.630635999999996, 32.028692], [58.626126, 32.039837999999996], [58.628192999999996, 32.051214], [58.634451, 32.046032], [58.642722, 32.058706], [58.640544999999996, 32.064645], [58.637105999999996, 32.057542999999995], [58.620061, 32.061088999999996], [58.618282, 32.070723], [58.623835, 32.086636999999996], [58.622015999999995, 32.097093], [58.620110999999994, 32.096759999999996], [58.619498, 32.091218999999995], [58.605323999999996, 32.096049], [58.602014999999994, 32.083062], [58.603069, 32.070879999999995], [58.592751, 32.072452999999996], [58.584633999999994, 32.065143], [58.587238, 32.047817], [58.593323, 32.047772], [58.597621, 32.034023], [58.599709, 32.034286], [58.599042, 32.030042], [58.606078, 32.007048], [58.606556, 32.000073], [58.598828, 32.004267999999996], [58.596675, 32.02039], [58.587553, 32.026767], [58.573453, 32.023252], [58.569133, 32.037991999999996], [58.561854, 32.037709], [58.550711, 32.04425], [58.542977, 32.038739], [58.51604, 32.063725999999996], [58.510304, 32.035286], [58.497144999999996, 32.016138], [58.492706, 32.014793], [58.478738, 31.952557], [58.479262999999996, 31.933940999999997], [58.435534, 31.934556999999998], [58.435865, 31.95021], [58.438337, 31.952544999999997], [58.437593, 31.958938999999997], [58.430025, 31.955164999999997], [58.428568999999996, 31.932475999999998], [58.422593, 31.934123999999997], [58.425894, 31.921955999999998], [58.421141999999996, 31.919802999999998], [58.419528, 31.931917], [58.411004, 31.93923], [58.411196999999994, 31.932246], [58.417486999999994, 31.921702], [58.417763, 31.916866], [58.383435, 31.929961], [58.382618, 31.936936], [58.370526, 31.93665], [58.370264, 31.90044], [58.359404, 31.900634999999998], [58.351226, 31.881805], [58.338449999999995, 31.882872], [58.337813999999995, 31.880004999999997], [58.335089999999994, 31.881573], [58.32939, 31.897588], [58.326069, 31.894026999999998], [58.328413, 31.886419], [58.331744, 31.885247], [58.331945, 31.876409], [58.327484, 31.876842], [58.332043, 31.854559], [58.314012999999996, 31.847061], [58.310280999999996, 31.864514], [58.295514999999995, 31.860948999999998], [58.291464999999995, 31.846096], [58.292418999999995, 31.816187], [58.282843, 31.812237999999997], [58.282740999999994, 31.781768999999997], [58.27533, 31.779014], [58.276574, 31.772146999999997], [58.274245, 31.750003], [58.268356, 31.764281999999998], [58.267495, 31.781104], [58.262420999999996, 31.775722], [58.256902999999994, 31.781440999999997], [58.253864, 31.765576], [58.253175, 31.742023], [58.250826999999994, 31.747041], [58.245069, 31.749754], [58.238986, 31.775592999999997], [58.236675999999996, 31.774375], [58.232875, 31.75408], [58.239512999999995, 31.737022999999997], [58.239644999999996, 31.724942], [58.233492999999996, 31.714622], [58.225575, 31.715771999999998], [58.22228, 31.702317999999998], [58.218453999999994, 31.699779999999997], [58.217008, 31.687448999999997], [58.216345, 31.571368], [58.250080999999994, 31.56048], [58.250257, 31.021313], [58.279410999999996, 30.954579], [58.283035, 30.940458], [58.280379999999994, 30.938149], [58.289893, 30.898484], [58.261804999999995, 30.851174999999998], [58.258261999999995, 30.848885], [58.265936999999994, 30.843574], [58.268138, 30.839107], [58.267249, 30.837093], [58.273002999999996, 30.830068999999998], [58.28416, 30.806739], [58.291948, 30.81995], [58.289142, 30.780209], [58.299689, 30.780153], [58.299796, 30.761322], [58.311499, 30.759964999999998], [58.311572, 30.773393], [58.347879, 30.769546], [58.348788, 30.805135], [58.444624, 30.7959], [58.444378, 30.776797], [58.442012, 30.772857], [58.439763, 30.77668], [58.436929, 30.773740999999998], [58.42896, 30.759750999999998], [58.431611, 30.756645], [58.420756999999995, 30.719285], [58.42577, 30.692331], [58.438663999999996, 30.701024], [58.434076999999995, 30.718843999999997], [58.437163999999996, 30.727794], [58.455037999999995, 30.749845999999998], [58.453758, 30.759483], [58.458704, 30.769771], [58.461379, 30.768472], [58.467087, 30.752055], [58.472435999999995, 30.753678999999998]], [[58.529311, 31.200588], [58.524550999999995, 31.209118], [58.522498, 31.205983], [58.521567, 31.212557], [58.51904, 31.209933999999997], [58.518950999999994, 31.220329999999997], [58.516701999999995, 31.220178999999998], [58.516433, 31.223615], [58.512062, 31.219519], [58.512283, 31.212542], [58.509876999999996, 31.212276], [58.508928, 31.219613], [58.506608, 31.221404999999997], [58.499347, 31.219689], [58.497505999999994, 31.237030999999998], [58.486048, 31.231222], [58.486833, 31.237320999999998], [58.491693999999995, 31.241905], [58.491265999999996, 31.249820999999997], [58.493378, 31.252447999999998], [58.491001999999995, 31.266078999999998], [58.486925, 31.261363999999997], [58.485429999999994, 31.269226999999997], [58.489675, 31.273671], [58.488454999999995, 31.280959], [58.482633, 31.272996], [58.478412999999996, 31.273312999999998], [58.476912, 31.268642], [58.473842, 31.273024999999997], [58.471084, 31.270069999999997], [58.472047999999994, 31.277006], [58.481327, 31.281781], [58.48674, 31.291182], [58.492202, 31.293001], [58.491375999999995, 31.301136999999997], [58.497657999999994, 31.297888999999998], [58.497522999999994, 31.294272999999997], [58.503467, 31.294009], [58.509164, 31.310447], [58.507697, 31.319481999999997], [58.513326, 31.327866], [58.516529999999996, 31.340063999999998], [58.52547, 31.331569], [58.533122999999996, 31.340377], [58.533485999999996, 31.326715999999998], [58.537079999999996, 31.328495999999998], [58.539820999999996, 31.324341999999998], [58.557685, 31.327403999999998], [58.562234999999994, 31.320159999999998], [58.563922999999996, 31.312678], [58.569131, 31.316336], [58.567403999999996, 31.344063], [58.57228, 31.342485], [58.573882, 31.348057999999998], [58.583059, 31.342793], [58.584365999999996, 31.345086], [58.592492, 31.394766999999998], [58.599239, 31.412501], [58.612727, 31.407251], [58.623943, 31.413929999999997], [58.627792, 31.422242999999998], [58.631029999999996, 31.421115999999998], [58.629304, 31.416923999999998], [58.631077999999995, 31.414299999999997], [58.626877, 31.40889], [58.636488, 31.401719999999997], [58.639322, 31.393642999999997], [58.645368, 31.399697999999997], [58.650749999999995, 31.386329], [58.642410999999996, 31.378213], [58.643935, 31.372455], [58.638828999999994, 31.367742999999997], [58.640480999999994, 31.362333999999997], [58.636098999999994, 31.357643], [58.63122, 31.366819999999997], [58.613284, 31.35482], [58.611931999999996, 31.356796], [58.612829, 31.362306], [58.608200999999994, 31.376209], [58.60622, 31.373413999999997], [58.603054, 31.377921999999998], [58.605751, 31.385773999999998], [58.603102, 31.388744], [58.605914999999996, 31.392369], [58.600167, 31.404536999999998], [58.59442, 31.392875999999998], [58.594136999999996, 31.382337999999997], [58.589335999999996, 31.365845], [58.591542, 31.358621999999997], [58.589071, 31.350331999999998], [58.592127999999995, 31.347029], [58.587052, 31.335193], [58.587469, 31.326375], [58.590492999999995, 31.321586], [58.588604, 31.318672], [58.589608999999996, 31.313965999999997], [58.577647, 31.297884], [58.579507, 31.290083], [58.587427999999996, 31.286305], [58.590092999999996, 31.263579999999997], [58.599261999999996, 31.257196999999998], [58.619170999999994, 31.272544999999997], [58.61814, 31.280078], [58.624105, 31.283756999999998], [58.630537, 31.25638], [58.630266999999996, 31.250847999999998], [58.632937999999996, 31.248444], [58.634726, 31.255969], [58.637753999999994, 31.252238], [58.636514999999996, 31.246104], [58.640845, 31.242455999999997], [58.633648, 31.209159999999997], [58.623723, 31.212868999999998], [58.621727, 31.205938999999997], [58.579102999999996, 31.241781], [58.572576999999995, 31.238626], [58.568768999999996, 31.241445], [58.562059999999995, 31.234209], [58.559399, 31.244443999999998], [58.555943, 31.245195], [58.550801, 31.240208], [58.554604999999995, 31.226512999999997], [58.553061, 31.226793999999998], [58.551990999999994, 31.221728], [58.545807999999994, 31.215138999999997], [58.537499999999994, 31.215373999999997], [58.536538, 31.198348]]]])
            else:
                complete_projects_count = Project.objects.filter(
                    complete=True).count()
                for i in Project.objects.all():
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = json.dumps([[[[58.476819, 30.717256], [58.479321999999996, 30.717965], [58.481337999999994, 30.726853], [58.482389999999995, 30.747809999999998], [58.504281999999996, 30.775219], [58.513675, 30.794238], [58.518791, 30.787437999999998], [58.529671, 30.804903999999997], [58.528589999999994, 30.814114999999997], [58.534482999999994, 30.830405], [58.543819, 30.82174], [58.548047999999994, 30.82713], [58.566523999999994, 30.824499999999997], [58.566432, 30.834075], [58.568887, 30.833762], [58.571296, 30.866196], [58.580568, 30.864504], [58.579983, 30.874879999999997], [58.604855, 30.869954], [58.607392999999995, 30.877992], [58.613341999999996, 30.87343], [58.619236, 30.883805], [58.62247, 30.89817], [58.628268999999996, 30.898873], [58.638816, 30.929420999999998], [58.645877, 30.939863], [58.639697, 30.940053], [58.63227, 30.931652], [58.643361, 30.974207999999997], [58.660396, 30.975873999999997], [58.679711, 31.001692], [58.679854999999996, 31.007483999999998], [58.683350999999995, 31.014933], [58.692868999999995, 31.015317999999997], [58.715906, 31.057011], [58.722680999999994, 31.039416], [58.730461, 31.043450999999997], [58.729419, 31.005239999999997], [58.725752, 30.998306999999997], [58.727695, 30.986748], [58.737486999999994, 31.006321999999997], [58.745749999999994, 30.990674], [58.743817, 30.981268], [58.742095, 30.981900999999997], [58.736962999999996, 30.969168], [58.73179, 30.965108999999998], [58.727995, 30.970623999999997], [58.724517999999996, 30.954228999999998], [58.716794, 30.93582], [58.708141999999995, 30.928451], [58.703903999999994, 30.917861], [58.706596, 30.908095999999997], [58.711994999999995, 30.903931], [58.723366, 30.913425999999998], [58.732333999999994, 30.929803], [58.744479, 30.910809999999998], [58.753355, 30.920876], [58.754976, 30.919877], [58.755221999999996, 30.914603999999997], [58.752624, 30.908765], [58.757531, 30.911023999999998], [58.758998, 30.900292], [58.756301, 30.86414], [58.749466999999996, 30.855767999999998], [58.744209, 30.843667999999997], [58.737235999999996, 30.838661], [58.727996999999995, 30.837661999999998], [58.737356, 30.813799999999997], [58.756299999999996, 30.805827999999998], [58.775425, 30.818931], [58.786137, 30.80856], [58.780519, 30.790533], [58.791433999999995, 30.775413], [58.796623, 30.778069], [58.800453, 30.769309999999997], [58.808142999999994, 30.776632], [58.810699, 30.765304999999998], [58.817533999999995, 30.773608], [58.837734, 30.773923], [58.852509, 30.763071], [58.855093, 30.768113999999997], [58.856655999999994, 30.762522999999998], [58.865790999999994, 30.765964999999998], [58.873712999999995, 30.773698999999997], [58.878173, 30.791864999999998], [58.876413, 30.794456999999998], [58.876579, 30.813316], [58.902885999999995, 30.872491999999998], [58.920815, 30.920842999999998], [58.942989, 30.95235], [58.964012999999994, 30.965609999999998], [58.973662, 30.954655], [58.980916, 30.979893999999998], [58.989422, 30.980075], [58.999765999999994, 31.006331999999997], [59.015741, 30.972284], [59.015701, 30.956722], [59.032554999999995, 30.956761999999998], [59.034796, 30.967475], [59.031844, 30.971863], [59.04405, 30.972704999999998], [59.044089, 30.984561999999997], [59.040687999999996, 30.991329], [59.057955, 31.015185], [59.068166, 31.022333999999997], [59.072917999999994, 31.042008], [59.077155, 31.050124999999998], [59.075191, 31.057612], [59.072339, 31.053268], [59.069281, 31.062706], [59.074380999999995, 31.071066], [59.090872999999995, 31.083081999999997], [59.089932, 31.131482], [59.078925, 31.153084], [59.075807999999995, 31.166840999999998], [59.069266, 31.164502], [59.062089, 31.167645999999998], [59.054956999999995, 31.156768], [59.054505999999996, 31.165834], [59.050267, 31.175680999999997], [59.04683, 31.166752], [59.046943, 31.190707], [58.969232, 31.25366], [58.969668, 31.275717], [58.972773, 31.293412999999997], [58.970755999999994, 31.313678], [58.962207, 31.304136], [58.952631999999994, 31.323301999999998], [58.942403999999996, 31.321633], [58.933518, 31.315098], [58.925484, 31.315623], [58.911685999999996, 31.297212], [58.860648999999995, 31.458512], [58.852069, 31.473674], [58.853851, 31.49544], [58.850328999999995, 31.495573], [58.852000999999994, 31.508371], [58.846962, 31.525508], [58.850618999999995, 31.529854], [58.846618, 31.539468999999997], [58.841077, 31.53596], [58.845912999999996, 31.554143999999997], [58.83734, 31.583375999999998], [58.839214, 31.599731], [58.831441999999996, 31.631138999999997], [58.838044, 31.647291], [58.845501, 31.653585], [58.836639999999996, 31.683982999999998], [58.840529999999994, 31.688266], [58.835153, 31.705789999999997], [58.836164999999994, 31.715144], [58.828947, 31.740364], [58.826539, 31.743416], [58.824569999999994, 31.741342999999997], [58.805129, 31.807260999999997], [58.838525999999995, 31.843217], [58.795562, 31.98742], [58.78736, 31.978471], [58.779303999999996, 32.00446], [58.714563, 31.943361999999997], [58.714093999999996, 31.931669999999997], [58.628389999999996, 31.923074999999997], [58.626638, 31.942396], [58.631190999999994, 31.945335999999998], [58.630617, 31.956142999999997], [58.638748, 31.963293], [58.636435, 31.974621], [58.633559, 31.975202999999997], [58.632031, 31.983038999999998], [58.632664, 31.998874999999998], [58.629965999999996, 32.000943], [58.630497999999996, 32.010811], [58.627700999999995, 32.010456999999995], [58.630078, 32.016106], [58.629273999999995, 32.024198], [58.630635999999996, 32.028692], [58.626126, 32.039837999999996], [58.628192999999996, 32.051214], [58.634451, 32.046032], [58.642722, 32.058706], [58.640544999999996, 32.064645], [58.637105999999996, 32.057542999999995], [58.620061, 32.061088999999996], [58.618282, 32.070723], [58.623835, 32.086636999999996], [58.622015999999995, 32.097093], [58.620110999999994, 32.096759999999996], [58.619498, 32.091218999999995], [58.605323999999996, 32.096049], [58.602014999999994, 32.083062], [58.603069, 32.070879999999995], [58.592751, 32.072452999999996], [58.584633999999994, 32.065143], [58.587238, 32.047817], [58.593323, 32.047772], [58.597621, 32.034023], [58.599709, 32.034286], [58.599042, 32.030042], [58.606078, 32.007048], [58.606556, 32.000073], [58.598828, 32.004267999999996], [58.596675, 32.02039], [58.587553, 32.026767], [58.573453, 32.023252], [58.569133, 32.037991999999996], [58.561854, 32.037709], [58.550711, 32.04425], [58.542977, 32.038739], [58.51604, 32.063725999999996], [58.510304, 32.035286], [58.497144999999996, 32.016138], [58.492706, 32.014793], [58.478738, 31.952557], [58.479262999999996, 31.933940999999997], [58.435534, 31.934556999999998], [58.435865, 31.95021], [58.438337, 31.952544999999997], [58.437593, 31.958938999999997], [58.430025, 31.955164999999997], [58.428568999999996, 31.932475999999998], [58.422593, 31.934123999999997], [58.425894, 31.921955999999998], [58.421141999999996, 31.919802999999998], [58.419528, 31.931917], [58.411004, 31.93923], [58.411196999999994, 31.932246], [58.417486999999994, 31.921702], [58.417763, 31.916866], [58.383435, 31.929961], [58.382618, 31.936936], [58.370526, 31.93665], [58.370264, 31.90044], [58.359404, 31.900634999999998], [58.351226, 31.881805], [58.338449999999995, 31.882872], [58.337813999999995, 31.880004999999997], [58.335089999999994, 31.881573], [58.32939, 31.897588], [58.326069, 31.894026999999998], [58.328413, 31.886419], [58.331744, 31.885247], [58.331945, 31.876409], [58.327484, 31.876842], [58.332043, 31.854559], [58.314012999999996, 31.847061], [58.310280999999996, 31.864514], [58.295514999999995, 31.860948999999998], [58.291464999999995, 31.846096], [58.292418999999995, 31.816187], [58.282843, 31.812237999999997], [58.282740999999994, 31.781768999999997], [58.27533, 31.779014], [58.276574, 31.772146999999997], [58.274245, 31.750003], [58.268356, 31.764281999999998], [58.267495, 31.781104], [58.262420999999996, 31.775722], [58.256902999999994, 31.781440999999997], [58.253864, 31.765576], [58.253175, 31.742023], [58.250826999999994, 31.747041], [58.245069, 31.749754], [58.238986, 31.775592999999997], [58.236675999999996, 31.774375], [58.232875, 31.75408], [58.239512999999995, 31.737022999999997], [58.239644999999996, 31.724942], [58.233492999999996, 31.714622], [58.225575, 31.715771999999998], [58.22228, 31.702317999999998], [58.218453999999994, 31.699779999999997], [58.217008, 31.687448999999997], [58.216345, 31.571368], [58.250080999999994, 31.56048], [58.250257, 31.021313], [58.279410999999996, 30.954579], [58.283035, 30.940458], [58.280379999999994, 30.938149], [58.289893, 30.898484], [58.261804999999995, 30.851174999999998], [58.258261999999995, 30.848885], [58.265936999999994, 30.843574], [58.268138, 30.839107], [58.267249, 30.837093], [58.273002999999996, 30.830068999999998], [58.28416, 30.806739], [58.291948, 30.81995], [58.289142, 30.780209], [58.299689, 30.780153], [58.299796, 30.761322], [58.311499, 30.759964999999998], [58.311572, 30.773393], [58.347879, 30.769546], [58.348788, 30.805135], [58.444624, 30.7959], [58.444378, 30.776797], [58.442012, 30.772857], [58.439763, 30.77668], [58.436929, 30.773740999999998], [58.42896, 30.759750999999998], [58.431611, 30.756645], [58.420756999999995, 30.719285], [58.42577, 30.692331], [58.438663999999996, 30.701024], [58.434076999999995, 30.718843999999997], [58.437163999999996, 30.727794], [58.455037999999995, 30.749845999999998], [58.453758, 30.759483], [58.458704, 30.769771], [58.461379, 30.768472], [58.467087, 30.752055], [58.472435999999995, 30.753678999999998]], [[58.529311, 31.200588], [58.524550999999995, 31.209118], [58.522498, 31.205983], [58.521567, 31.212557], [58.51904, 31.209933999999997], [58.518950999999994, 31.220329999999997], [58.516701999999995, 31.220178999999998], [58.516433, 31.223615], [58.512062, 31.219519], [58.512283, 31.212542], [58.509876999999996, 31.212276], [58.508928, 31.219613], [58.506608, 31.221404999999997], [58.499347, 31.219689], [58.497505999999994, 31.237030999999998], [58.486048, 31.231222], [58.486833, 31.237320999999998], [58.491693999999995, 31.241905], [58.491265999999996, 31.249820999999997], [58.493378, 31.252447999999998], [58.491001999999995, 31.266078999999998], [58.486925, 31.261363999999997], [58.485429999999994, 31.269226999999997], [58.489675, 31.273671], [58.488454999999995, 31.280959], [58.482633, 31.272996], [58.478412999999996, 31.273312999999998], [58.476912, 31.268642], [58.473842, 31.273024999999997], [58.471084, 31.270069999999997], [58.472047999999994, 31.277006], [58.481327, 31.281781], [58.48674, 31.291182], [58.492202, 31.293001], [58.491375999999995, 31.301136999999997], [58.497657999999994, 31.297888999999998], [58.497522999999994, 31.294272999999997], [58.503467, 31.294009], [58.509164, 31.310447], [58.507697, 31.319481999999997], [58.513326, 31.327866], [58.516529999999996, 31.340063999999998], [58.52547, 31.331569], [58.533122999999996, 31.340377], [58.533485999999996, 31.326715999999998], [58.537079999999996, 31.328495999999998], [58.539820999999996, 31.324341999999998], [58.557685, 31.327403999999998], [58.562234999999994, 31.320159999999998], [58.563922999999996, 31.312678], [58.569131, 31.316336], [58.567403999999996, 31.344063], [58.57228, 31.342485], [58.573882, 31.348057999999998], [58.583059, 31.342793], [58.584365999999996, 31.345086], [58.592492, 31.394766999999998], [58.599239, 31.412501], [58.612727, 31.407251], [58.623943, 31.413929999999997], [58.627792, 31.422242999999998], [58.631029999999996, 31.421115999999998], [58.629304, 31.416923999999998], [58.631077999999995, 31.414299999999997], [58.626877, 31.40889], [58.636488, 31.401719999999997], [58.639322, 31.393642999999997], [58.645368, 31.399697999999997], [58.650749999999995, 31.386329], [58.642410999999996, 31.378213], [58.643935, 31.372455], [58.638828999999994, 31.367742999999997], [58.640480999999994, 31.362333999999997], [58.636098999999994, 31.357643], [58.63122, 31.366819999999997], [58.613284, 31.35482], [58.611931999999996, 31.356796], [58.612829, 31.362306], [58.608200999999994, 31.376209], [58.60622, 31.373413999999997], [58.603054, 31.377921999999998], [58.605751, 31.385773999999998], [58.603102, 31.388744], [58.605914999999996, 31.392369], [58.600167, 31.404536999999998], [58.59442, 31.392875999999998], [58.594136999999996, 31.382337999999997], [58.589335999999996, 31.365845], [58.591542, 31.358621999999997], [58.589071, 31.350331999999998], [58.592127999999995, 31.347029], [58.587052, 31.335193], [58.587469, 31.326375], [58.590492999999995, 31.321586], [58.588604, 31.318672], [58.589608999999996, 31.313965999999997], [58.577647, 31.297884], [58.579507, 31.290083], [58.587427999999996, 31.286305], [58.590092999999996, 31.263579999999997], [58.599261999999996, 31.257196999999998], [58.619170999999994, 31.272544999999997], [58.61814, 31.280078], [58.624105, 31.283756999999998], [58.630537, 31.25638], [58.630266999999996, 31.250847999999998], [58.632937999999996, 31.248444], [58.634726, 31.255969], [58.637753999999994, 31.252238], [58.636514999999996, 31.246104], [58.640845, 31.242455999999997], [58.633648, 31.209159999999997], [58.623723, 31.212868999999998], [58.621727, 31.205938999999997], [58.579102999999996, 31.241781], [58.572576999999995, 31.238626], [58.568768999999996, 31.241445], [58.562059999999995, 31.234209], [58.559399, 31.244443999999998], [58.555943, 31.245195], [58.550801, 31.240208], [58.554604999999995, 31.226512999999997], [58.553061, 31.226793999999998], [58.551990999999994, 31.221728], [58.545807999999994, 31.215138999999997], [58.537499999999994, 31.215373999999997], [58.536538, 31.198348]]]])

    return response.JsonResponse({'ob_list': ob_list, 'r_coords': r_coords, 'complete_projects_count': complete_projects_count, 'r_id': request.GET.get('r_id'), 'c_id': request.GET.get('c_id') })


@csrf_exempt
def Complete_projects_listView(request):
    projects_list = {}
    p_list = {}
    p_adr_list = {}
    mark_list = {}
    p_id = {}
    ob_list = {}
    r_coords = None
    complete_projects_count = 0
    if request.method == 'GET':
        if request.GET.get('r_id') != '0':
            if request.GET.get('c_id') != '0':
                complete_projects_count = Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__id = request.GET.get('c_id')).filter(complete=True).count()
                for i in Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__id = request.GET.get('c_id')).filter(complete=True):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = Rayon.objects.get(id = request.GET.get('r_id')).coords
            else:
                complete_projects_count = Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__active = True).filter(complete=True).count()
                for i in Project.objects.filter(rayon__id=request.GET.get('r_id')).filter(category__active = True).filter(complete=True):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = Rayon.objects.get(id = request.GET.get('r_id')).coords
        else:
            if request.GET.get('c_id') != '0':
                complete_projects_count = Project.objects.filter(category__id = request.GET.get('c_id')).filter(complete=True).count()
                for i in Project.objects.filter(category__id = request.GET.get('c_id')).filter(complete=True):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = json.dumps([[[[58.476819, 30.717256], [58.479321999999996, 30.717965], [58.481337999999994, 30.726853], [58.482389999999995, 30.747809999999998], [58.504281999999996, 30.775219], [58.513675, 30.794238], [58.518791, 30.787437999999998], [58.529671, 30.804903999999997], [58.528589999999994, 30.814114999999997], [58.534482999999994, 30.830405], [58.543819, 30.82174], [58.548047999999994, 30.82713], [58.566523999999994, 30.824499999999997], [58.566432, 30.834075], [58.568887, 30.833762], [58.571296, 30.866196], [58.580568, 30.864504], [58.579983, 30.874879999999997], [58.604855, 30.869954], [58.607392999999995, 30.877992], [58.613341999999996, 30.87343], [58.619236, 30.883805], [58.62247, 30.89817], [58.628268999999996, 30.898873], [58.638816, 30.929420999999998], [58.645877, 30.939863], [58.639697, 30.940053], [58.63227, 30.931652], [58.643361, 30.974207999999997], [58.660396, 30.975873999999997], [58.679711, 31.001692], [58.679854999999996, 31.007483999999998], [58.683350999999995, 31.014933], [58.692868999999995, 31.015317999999997], [58.715906, 31.057011], [58.722680999999994, 31.039416], [58.730461, 31.043450999999997], [58.729419, 31.005239999999997], [58.725752, 30.998306999999997], [58.727695, 30.986748], [58.737486999999994, 31.006321999999997], [58.745749999999994, 30.990674], [58.743817, 30.981268], [58.742095, 30.981900999999997], [58.736962999999996, 30.969168], [58.73179, 30.965108999999998], [58.727995, 30.970623999999997], [58.724517999999996, 30.954228999999998], [58.716794, 30.93582], [58.708141999999995, 30.928451], [58.703903999999994, 30.917861], [58.706596, 30.908095999999997], [58.711994999999995, 30.903931], [58.723366, 30.913425999999998], [58.732333999999994, 30.929803], [58.744479, 30.910809999999998], [58.753355, 30.920876], [58.754976, 30.919877], [58.755221999999996, 30.914603999999997], [58.752624, 30.908765], [58.757531, 30.911023999999998], [58.758998, 30.900292], [58.756301, 30.86414], [58.749466999999996, 30.855767999999998], [58.744209, 30.843667999999997], [58.737235999999996, 30.838661], [58.727996999999995, 30.837661999999998], [58.737356, 30.813799999999997], [58.756299999999996, 30.805827999999998], [58.775425, 30.818931], [58.786137, 30.80856], [58.780519, 30.790533], [58.791433999999995, 30.775413], [58.796623, 30.778069], [58.800453, 30.769309999999997], [58.808142999999994, 30.776632], [58.810699, 30.765304999999998], [58.817533999999995, 30.773608], [58.837734, 30.773923], [58.852509, 30.763071], [58.855093, 30.768113999999997], [58.856655999999994, 30.762522999999998], [58.865790999999994, 30.765964999999998], [58.873712999999995, 30.773698999999997], [58.878173, 30.791864999999998], [58.876413, 30.794456999999998], [58.876579, 30.813316], [58.902885999999995, 30.872491999999998], [58.920815, 30.920842999999998], [58.942989, 30.95235], [58.964012999999994, 30.965609999999998], [58.973662, 30.954655], [58.980916, 30.979893999999998], [58.989422, 30.980075], [58.999765999999994, 31.006331999999997], [59.015741, 30.972284], [59.015701, 30.956722], [59.032554999999995, 30.956761999999998], [59.034796, 30.967475], [59.031844, 30.971863], [59.04405, 30.972704999999998], [59.044089, 30.984561999999997], [59.040687999999996, 30.991329], [59.057955, 31.015185], [59.068166, 31.022333999999997], [59.072917999999994, 31.042008], [59.077155, 31.050124999999998], [59.075191, 31.057612], [59.072339, 31.053268], [59.069281, 31.062706], [59.074380999999995, 31.071066], [59.090872999999995, 31.083081999999997], [59.089932, 31.131482], [59.078925, 31.153084], [59.075807999999995, 31.166840999999998], [59.069266, 31.164502], [59.062089, 31.167645999999998], [59.054956999999995, 31.156768], [59.054505999999996, 31.165834], [59.050267, 31.175680999999997], [59.04683, 31.166752], [59.046943, 31.190707], [58.969232, 31.25366], [58.969668, 31.275717], [58.972773, 31.293412999999997], [58.970755999999994, 31.313678], [58.962207, 31.304136], [58.952631999999994, 31.323301999999998], [58.942403999999996, 31.321633], [58.933518, 31.315098], [58.925484, 31.315623], [58.911685999999996, 31.297212], [58.860648999999995, 31.458512], [58.852069, 31.473674], [58.853851, 31.49544], [58.850328999999995, 31.495573], [58.852000999999994, 31.508371], [58.846962, 31.525508], [58.850618999999995, 31.529854], [58.846618, 31.539468999999997], [58.841077, 31.53596], [58.845912999999996, 31.554143999999997], [58.83734, 31.583375999999998], [58.839214, 31.599731], [58.831441999999996, 31.631138999999997], [58.838044, 31.647291], [58.845501, 31.653585], [58.836639999999996, 31.683982999999998], [58.840529999999994, 31.688266], [58.835153, 31.705789999999997], [58.836164999999994, 31.715144], [58.828947, 31.740364], [58.826539, 31.743416], [58.824569999999994, 31.741342999999997], [58.805129, 31.807260999999997], [58.838525999999995, 31.843217], [58.795562, 31.98742], [58.78736, 31.978471], [58.779303999999996, 32.00446], [58.714563, 31.943361999999997], [58.714093999999996, 31.931669999999997], [58.628389999999996, 31.923074999999997], [58.626638, 31.942396], [58.631190999999994, 31.945335999999998], [58.630617, 31.956142999999997], [58.638748, 31.963293], [58.636435, 31.974621], [58.633559, 31.975202999999997], [58.632031, 31.983038999999998], [58.632664, 31.998874999999998], [58.629965999999996, 32.000943], [58.630497999999996, 32.010811], [58.627700999999995, 32.010456999999995], [58.630078, 32.016106], [58.629273999999995, 32.024198], [58.630635999999996, 32.028692], [58.626126, 32.039837999999996], [58.628192999999996, 32.051214], [58.634451, 32.046032], [58.642722, 32.058706], [58.640544999999996, 32.064645], [58.637105999999996, 32.057542999999995], [58.620061, 32.061088999999996], [58.618282, 32.070723], [58.623835, 32.086636999999996], [58.622015999999995, 32.097093], [58.620110999999994, 32.096759999999996], [58.619498, 32.091218999999995], [58.605323999999996, 32.096049], [58.602014999999994, 32.083062], [58.603069, 32.070879999999995], [58.592751, 32.072452999999996], [58.584633999999994, 32.065143], [58.587238, 32.047817], [58.593323, 32.047772], [58.597621, 32.034023], [58.599709, 32.034286], [58.599042, 32.030042], [58.606078, 32.007048], [58.606556, 32.000073], [58.598828, 32.004267999999996], [58.596675, 32.02039], [58.587553, 32.026767], [58.573453, 32.023252], [58.569133, 32.037991999999996], [58.561854, 32.037709], [58.550711, 32.04425], [58.542977, 32.038739], [58.51604, 32.063725999999996], [58.510304, 32.035286], [58.497144999999996, 32.016138], [58.492706, 32.014793], [58.478738, 31.952557], [58.479262999999996, 31.933940999999997], [58.435534, 31.934556999999998], [58.435865, 31.95021], [58.438337, 31.952544999999997], [58.437593, 31.958938999999997], [58.430025, 31.955164999999997], [58.428568999999996, 31.932475999999998], [58.422593, 31.934123999999997], [58.425894, 31.921955999999998], [58.421141999999996, 31.919802999999998], [58.419528, 31.931917], [58.411004, 31.93923], [58.411196999999994, 31.932246], [58.417486999999994, 31.921702], [58.417763, 31.916866], [58.383435, 31.929961], [58.382618, 31.936936], [58.370526, 31.93665], [58.370264, 31.90044], [58.359404, 31.900634999999998], [58.351226, 31.881805], [58.338449999999995, 31.882872], [58.337813999999995, 31.880004999999997], [58.335089999999994, 31.881573], [58.32939, 31.897588], [58.326069, 31.894026999999998], [58.328413, 31.886419], [58.331744, 31.885247], [58.331945, 31.876409], [58.327484, 31.876842], [58.332043, 31.854559], [58.314012999999996, 31.847061], [58.310280999999996, 31.864514], [58.295514999999995, 31.860948999999998], [58.291464999999995, 31.846096], [58.292418999999995, 31.816187], [58.282843, 31.812237999999997], [58.282740999999994, 31.781768999999997], [58.27533, 31.779014], [58.276574, 31.772146999999997], [58.274245, 31.750003], [58.268356, 31.764281999999998], [58.267495, 31.781104], [58.262420999999996, 31.775722], [58.256902999999994, 31.781440999999997], [58.253864, 31.765576], [58.253175, 31.742023], [58.250826999999994, 31.747041], [58.245069, 31.749754], [58.238986, 31.775592999999997], [58.236675999999996, 31.774375], [58.232875, 31.75408], [58.239512999999995, 31.737022999999997], [58.239644999999996, 31.724942], [58.233492999999996, 31.714622], [58.225575, 31.715771999999998], [58.22228, 31.702317999999998], [58.218453999999994, 31.699779999999997], [58.217008, 31.687448999999997], [58.216345, 31.571368], [58.250080999999994, 31.56048], [58.250257, 31.021313], [58.279410999999996, 30.954579], [58.283035, 30.940458], [58.280379999999994, 30.938149], [58.289893, 30.898484], [58.261804999999995, 30.851174999999998], [58.258261999999995, 30.848885], [58.265936999999994, 30.843574], [58.268138, 30.839107], [58.267249, 30.837093], [58.273002999999996, 30.830068999999998], [58.28416, 30.806739], [58.291948, 30.81995], [58.289142, 30.780209], [58.299689, 30.780153], [58.299796, 30.761322], [58.311499, 30.759964999999998], [58.311572, 30.773393], [58.347879, 30.769546], [58.348788, 30.805135], [58.444624, 30.7959], [58.444378, 30.776797], [58.442012, 30.772857], [58.439763, 30.77668], [58.436929, 30.773740999999998], [58.42896, 30.759750999999998], [58.431611, 30.756645], [58.420756999999995, 30.719285], [58.42577, 30.692331], [58.438663999999996, 30.701024], [58.434076999999995, 30.718843999999997], [58.437163999999996, 30.727794], [58.455037999999995, 30.749845999999998], [58.453758, 30.759483], [58.458704, 30.769771], [58.461379, 30.768472], [58.467087, 30.752055], [58.472435999999995, 30.753678999999998]], [[58.529311, 31.200588], [58.524550999999995, 31.209118], [58.522498, 31.205983], [58.521567, 31.212557], [58.51904, 31.209933999999997], [58.518950999999994, 31.220329999999997], [58.516701999999995, 31.220178999999998], [58.516433, 31.223615], [58.512062, 31.219519], [58.512283, 31.212542], [58.509876999999996, 31.212276], [58.508928, 31.219613], [58.506608, 31.221404999999997], [58.499347, 31.219689], [58.497505999999994, 31.237030999999998], [58.486048, 31.231222], [58.486833, 31.237320999999998], [58.491693999999995, 31.241905], [58.491265999999996, 31.249820999999997], [58.493378, 31.252447999999998], [58.491001999999995, 31.266078999999998], [58.486925, 31.261363999999997], [58.485429999999994, 31.269226999999997], [58.489675, 31.273671], [58.488454999999995, 31.280959], [58.482633, 31.272996], [58.478412999999996, 31.273312999999998], [58.476912, 31.268642], [58.473842, 31.273024999999997], [58.471084, 31.270069999999997], [58.472047999999994, 31.277006], [58.481327, 31.281781], [58.48674, 31.291182], [58.492202, 31.293001], [58.491375999999995, 31.301136999999997], [58.497657999999994, 31.297888999999998], [58.497522999999994, 31.294272999999997], [58.503467, 31.294009], [58.509164, 31.310447], [58.507697, 31.319481999999997], [58.513326, 31.327866], [58.516529999999996, 31.340063999999998], [58.52547, 31.331569], [58.533122999999996, 31.340377], [58.533485999999996, 31.326715999999998], [58.537079999999996, 31.328495999999998], [58.539820999999996, 31.324341999999998], [58.557685, 31.327403999999998], [58.562234999999994, 31.320159999999998], [58.563922999999996, 31.312678], [58.569131, 31.316336], [58.567403999999996, 31.344063], [58.57228, 31.342485], [58.573882, 31.348057999999998], [58.583059, 31.342793], [58.584365999999996, 31.345086], [58.592492, 31.394766999999998], [58.599239, 31.412501], [58.612727, 31.407251], [58.623943, 31.413929999999997], [58.627792, 31.422242999999998], [58.631029999999996, 31.421115999999998], [58.629304, 31.416923999999998], [58.631077999999995, 31.414299999999997], [58.626877, 31.40889], [58.636488, 31.401719999999997], [58.639322, 31.393642999999997], [58.645368, 31.399697999999997], [58.650749999999995, 31.386329], [58.642410999999996, 31.378213], [58.643935, 31.372455], [58.638828999999994, 31.367742999999997], [58.640480999999994, 31.362333999999997], [58.636098999999994, 31.357643], [58.63122, 31.366819999999997], [58.613284, 31.35482], [58.611931999999996, 31.356796], [58.612829, 31.362306], [58.608200999999994, 31.376209], [58.60622, 31.373413999999997], [58.603054, 31.377921999999998], [58.605751, 31.385773999999998], [58.603102, 31.388744], [58.605914999999996, 31.392369], [58.600167, 31.404536999999998], [58.59442, 31.392875999999998], [58.594136999999996, 31.382337999999997], [58.589335999999996, 31.365845], [58.591542, 31.358621999999997], [58.589071, 31.350331999999998], [58.592127999999995, 31.347029], [58.587052, 31.335193], [58.587469, 31.326375], [58.590492999999995, 31.321586], [58.588604, 31.318672], [58.589608999999996, 31.313965999999997], [58.577647, 31.297884], [58.579507, 31.290083], [58.587427999999996, 31.286305], [58.590092999999996, 31.263579999999997], [58.599261999999996, 31.257196999999998], [58.619170999999994, 31.272544999999997], [58.61814, 31.280078], [58.624105, 31.283756999999998], [58.630537, 31.25638], [58.630266999999996, 31.250847999999998], [58.632937999999996, 31.248444], [58.634726, 31.255969], [58.637753999999994, 31.252238], [58.636514999999996, 31.246104], [58.640845, 31.242455999999997], [58.633648, 31.209159999999997], [58.623723, 31.212868999999998], [58.621727, 31.205938999999997], [58.579102999999996, 31.241781], [58.572576999999995, 31.238626], [58.568768999999996, 31.241445], [58.562059999999995, 31.234209], [58.559399, 31.244443999999998], [58.555943, 31.245195], [58.550801, 31.240208], [58.554604999999995, 31.226512999999997], [58.553061, 31.226793999999998], [58.551990999999994, 31.221728], [58.545807999999994, 31.215138999999997], [58.537499999999994, 31.215373999999997], [58.536538, 31.198348]]]])
            else:
                complete_projects_count = Project.objects.filter(category__active = True).filter(complete=True).count()
                for i in Project.objects.filter(category__active = True).filter(complete=True).filter(on_main=True):
                    proj = {}
                    proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker', i.marker),
                                 ('color', i.category.color)]
                    proj.update(proj_list)
                    ob_list.update({i.id: proj})
                    r_coords = json.dumps([[[[58.476819, 30.717256], [58.479321999999996, 30.717965],
                                             [58.481337999999994, 30.726853], [58.482389999999995, 30.747809999999998],
                                             [58.504281999999996, 30.775219], [58.513675, 30.794238],
                                             [58.518791, 30.787437999999998], [58.529671, 30.804903999999997],
                                             [58.528589999999994, 30.814114999999997], [58.534482999999994, 30.830405],
                                             [58.543819, 30.82174], [58.548047999999994, 30.82713],
                                             [58.566523999999994, 30.824499999999997], [58.566432, 30.834075],
                                             [58.568887, 30.833762], [58.571296, 30.866196], [58.580568, 30.864504],
                                             [58.579983, 30.874879999999997], [58.604855, 30.869954],
                                             [58.607392999999995, 30.877992], [58.613341999999996, 30.87343],
                                             [58.619236, 30.883805], [58.62247, 30.89817],
                                             [58.628268999999996, 30.898873], [58.638816, 30.929420999999998],
                                             [58.645877, 30.939863], [58.639697, 30.940053], [58.63227, 30.931652],
                                             [58.643361, 30.974207999999997], [58.660396, 30.975873999999997],
                                             [58.679711, 31.001692], [58.679854999999996, 31.007483999999998],
                                             [58.683350999999995, 31.014933], [58.692868999999995, 31.015317999999997],
                                             [58.715906, 31.057011], [58.722680999999994, 31.039416],
                                             [58.730461, 31.043450999999997], [58.729419, 31.005239999999997],
                                             [58.725752, 30.998306999999997], [58.727695, 30.986748],
                                             [58.737486999999994, 31.006321999999997], [58.745749999999994, 30.990674],
                                             [58.743817, 30.981268], [58.742095, 30.981900999999997],
                                             [58.736962999999996, 30.969168], [58.73179, 30.965108999999998],
                                             [58.727995, 30.970623999999997], [58.724517999999996, 30.954228999999998],
                                             [58.716794, 30.93582], [58.708141999999995, 30.928451],
                                             [58.703903999999994, 30.917861], [58.706596, 30.908095999999997],
                                             [58.711994999999995, 30.903931], [58.723366, 30.913425999999998],
                                             [58.732333999999994, 30.929803], [58.744479, 30.910809999999998],
                                             [58.753355, 30.920876], [58.754976, 30.919877],
                                             [58.755221999999996, 30.914603999999997], [58.752624, 30.908765],
                                             [58.757531, 30.911023999999998], [58.758998, 30.900292],
                                             [58.756301, 30.86414], [58.749466999999996, 30.855767999999998],
                                             [58.744209, 30.843667999999997], [58.737235999999996, 30.838661],
                                             [58.727996999999995, 30.837661999999998], [58.737356, 30.813799999999997],
                                             [58.756299999999996, 30.805827999999998], [58.775425, 30.818931],
                                             [58.786137, 30.80856], [58.780519, 30.790533],
                                             [58.791433999999995, 30.775413], [58.796623, 30.778069],
                                             [58.800453, 30.769309999999997], [58.808142999999994, 30.776632],
                                             [58.810699, 30.765304999999998], [58.817533999999995, 30.773608],
                                             [58.837734, 30.773923], [58.852509, 30.763071],
                                             [58.855093, 30.768113999999997], [58.856655999999994, 30.762522999999998],
                                             [58.865790999999994, 30.765964999999998],
                                             [58.873712999999995, 30.773698999999997], [58.878173, 30.791864999999998],
                                             [58.876413, 30.794456999999998], [58.876579, 30.813316],
                                             [58.902885999999995, 30.872491999999998], [58.920815, 30.920842999999998],
                                             [58.942989, 30.95235], [58.964012999999994, 30.965609999999998],
                                             [58.973662, 30.954655], [58.980916, 30.979893999999998],
                                             [58.989422, 30.980075], [58.999765999999994, 31.006331999999997],
                                             [59.015741, 30.972284], [59.015701, 30.956722],
                                             [59.032554999999995, 30.956761999999998], [59.034796, 30.967475],
                                             [59.031844, 30.971863], [59.04405, 30.972704999999998],
                                             [59.044089, 30.984561999999997], [59.040687999999996, 30.991329],
                                             [59.057955, 31.015185], [59.068166, 31.022333999999997],
                                             [59.072917999999994, 31.042008], [59.077155, 31.050124999999998],
                                             [59.075191, 31.057612], [59.072339, 31.053268], [59.069281, 31.062706],
                                             [59.074380999999995, 31.071066], [59.090872999999995, 31.083081999999997],
                                             [59.089932, 31.131482], [59.078925, 31.153084],
                                             [59.075807999999995, 31.166840999999998], [59.069266, 31.164502],
                                             [59.062089, 31.167645999999998], [59.054956999999995, 31.156768],
                                             [59.054505999999996, 31.165834], [59.050267, 31.175680999999997],
                                             [59.04683, 31.166752], [59.046943, 31.190707], [58.969232, 31.25366],
                                             [58.969668, 31.275717], [58.972773, 31.293412999999997],
                                             [58.970755999999994, 31.313678], [58.962207, 31.304136],
                                             [58.952631999999994, 31.323301999999998], [58.942403999999996, 31.321633],
                                             [58.933518, 31.315098], [58.925484, 31.315623],
                                             [58.911685999999996, 31.297212], [58.860648999999995, 31.458512],
                                             [58.852069, 31.473674], [58.853851, 31.49544],
                                             [58.850328999999995, 31.495573], [58.852000999999994, 31.508371],
                                             [58.846962, 31.525508], [58.850618999999995, 31.529854],
                                             [58.846618, 31.539468999999997], [58.841077, 31.53596],
                                             [58.845912999999996, 31.554143999999997], [58.83734, 31.583375999999998],
                                             [58.839214, 31.599731], [58.831441999999996, 31.631138999999997],
                                             [58.838044, 31.647291], [58.845501, 31.653585],
                                             [58.836639999999996, 31.683982999999998], [58.840529999999994, 31.688266],
                                             [58.835153, 31.705789999999997], [58.836164999999994, 31.715144],
                                             [58.828947, 31.740364], [58.826539, 31.743416],
                                             [58.824569999999994, 31.741342999999997], [58.805129, 31.807260999999997],
                                             [58.838525999999995, 31.843217], [58.795562, 31.98742],
                                             [58.78736, 31.978471], [58.779303999999996, 32.00446],
                                             [58.714563, 31.943361999999997], [58.714093999999996, 31.931669999999997],
                                             [58.628389999999996, 31.923074999999997], [58.626638, 31.942396],
                                             [58.631190999999994, 31.945335999999998], [58.630617, 31.956142999999997],
                                             [58.638748, 31.963293], [58.636435, 31.974621],
                                             [58.633559, 31.975202999999997], [58.632031, 31.983038999999998],
                                             [58.632664, 31.998874999999998], [58.629965999999996, 32.000943],
                                             [58.630497999999996, 32.010811], [58.627700999999995, 32.010456999999995],
                                             [58.630078, 32.016106], [58.629273999999995, 32.024198],
                                             [58.630635999999996, 32.028692], [58.626126, 32.039837999999996],
                                             [58.628192999999996, 32.051214], [58.634451, 32.046032],
                                             [58.642722, 32.058706], [58.640544999999996, 32.064645],
                                             [58.637105999999996, 32.057542999999995], [58.620061, 32.061088999999996],
                                             [58.618282, 32.070723], [58.623835, 32.086636999999996],
                                             [58.622015999999995, 32.097093], [58.620110999999994, 32.096759999999996],
                                             [58.619498, 32.091218999999995], [58.605323999999996, 32.096049],
                                             [58.602014999999994, 32.083062], [58.603069, 32.070879999999995],
                                             [58.592751, 32.072452999999996], [58.584633999999994, 32.065143],
                                             [58.587238, 32.047817], [58.593323, 32.047772], [58.597621, 32.034023],
                                             [58.599709, 32.034286], [58.599042, 32.030042], [58.606078, 32.007048],
                                             [58.606556, 32.000073], [58.598828, 32.004267999999996],
                                             [58.596675, 32.02039], [58.587553, 32.026767], [58.573453, 32.023252],
                                             [58.569133, 32.037991999999996], [58.561854, 32.037709],
                                             [58.550711, 32.04425], [58.542977, 32.038739],
                                             [58.51604, 32.063725999999996], [58.510304, 32.035286],
                                             [58.497144999999996, 32.016138], [58.492706, 32.014793],
                                             [58.478738, 31.952557], [58.479262999999996, 31.933940999999997],
                                             [58.435534, 31.934556999999998], [58.435865, 31.95021],
                                             [58.438337, 31.952544999999997], [58.437593, 31.958938999999997],
                                             [58.430025, 31.955164999999997], [58.428568999999996, 31.932475999999998],
                                             [58.422593, 31.934123999999997], [58.425894, 31.921955999999998],
                                             [58.421141999999996, 31.919802999999998], [58.419528, 31.931917],
                                             [58.411004, 31.93923], [58.411196999999994, 31.932246],
                                             [58.417486999999994, 31.921702], [58.417763, 31.916866],
                                             [58.383435, 31.929961], [58.382618, 31.936936], [58.370526, 31.93665],
                                             [58.370264, 31.90044], [58.359404, 31.900634999999998],
                                             [58.351226, 31.881805], [58.338449999999995, 31.882872],
                                             [58.337813999999995, 31.880004999999997], [58.335089999999994, 31.881573],
                                             [58.32939, 31.897588], [58.326069, 31.894026999999998],
                                             [58.328413, 31.886419], [58.331744, 31.885247], [58.331945, 31.876409],
                                             [58.327484, 31.876842], [58.332043, 31.854559],
                                             [58.314012999999996, 31.847061], [58.310280999999996, 31.864514],
                                             [58.295514999999995, 31.860948999999998], [58.291464999999995, 31.846096],
                                             [58.292418999999995, 31.816187], [58.282843, 31.812237999999997],
                                             [58.282740999999994, 31.781768999999997], [58.27533, 31.779014],
                                             [58.276574, 31.772146999999997], [58.274245, 31.750003],
                                             [58.268356, 31.764281999999998], [58.267495, 31.781104],
                                             [58.262420999999996, 31.775722], [58.256902999999994, 31.781440999999997],
                                             [58.253864, 31.765576], [58.253175, 31.742023],
                                             [58.250826999999994, 31.747041], [58.245069, 31.749754],
                                             [58.238986, 31.775592999999997], [58.236675999999996, 31.774375],
                                             [58.232875, 31.75408], [58.239512999999995, 31.737022999999997],
                                             [58.239644999999996, 31.724942], [58.233492999999996, 31.714622],
                                             [58.225575, 31.715771999999998], [58.22228, 31.702317999999998],
                                             [58.218453999999994, 31.699779999999997], [58.217008, 31.687448999999997],
                                             [58.216345, 31.571368], [58.250080999999994, 31.56048],
                                             [58.250257, 31.021313], [58.279410999999996, 30.954579],
                                             [58.283035, 30.940458], [58.280379999999994, 30.938149],
                                             [58.289893, 30.898484], [58.261804999999995, 30.851174999999998],
                                             [58.258261999999995, 30.848885], [58.265936999999994, 30.843574],
                                             [58.268138, 30.839107], [58.267249, 30.837093],
                                             [58.273002999999996, 30.830068999999998], [58.28416, 30.806739],
                                             [58.291948, 30.81995], [58.289142, 30.780209], [58.299689, 30.780153],
                                             [58.299796, 30.761322], [58.311499, 30.759964999999998],
                                             [58.311572, 30.773393], [58.347879, 30.769546], [58.348788, 30.805135],
                                             [58.444624, 30.7959], [58.444378, 30.776797], [58.442012, 30.772857],
                                             [58.439763, 30.77668], [58.436929, 30.773740999999998],
                                             [58.42896, 30.759750999999998], [58.431611, 30.756645],
                                             [58.420756999999995, 30.719285], [58.42577, 30.692331],
                                             [58.438663999999996, 30.701024], [58.434076999999995, 30.718843999999997],
                                             [58.437163999999996, 30.727794], [58.455037999999995, 30.749845999999998],
                                             [58.453758, 30.759483], [58.458704, 30.769771], [58.461379, 30.768472],
                                             [58.467087, 30.752055], [58.472435999999995, 30.753678999999998]],
                                            [[58.529311, 31.200588], [58.524550999999995, 31.209118],
                                             [58.522498, 31.205983], [58.521567, 31.212557],
                                             [58.51904, 31.209933999999997], [58.518950999999994, 31.220329999999997],
                                             [58.516701999999995, 31.220178999999998], [58.516433, 31.223615],
                                             [58.512062, 31.219519], [58.512283, 31.212542],
                                             [58.509876999999996, 31.212276], [58.508928, 31.219613],
                                             [58.506608, 31.221404999999997], [58.499347, 31.219689],
                                             [58.497505999999994, 31.237030999999998], [58.486048, 31.231222],
                                             [58.486833, 31.237320999999998], [58.491693999999995, 31.241905],
                                             [58.491265999999996, 31.249820999999997], [58.493378, 31.252447999999998],
                                             [58.491001999999995, 31.266078999999998], [58.486925, 31.261363999999997],
                                             [58.485429999999994, 31.269226999999997], [58.489675, 31.273671],
                                             [58.488454999999995, 31.280959], [58.482633, 31.272996],
                                             [58.478412999999996, 31.273312999999998], [58.476912, 31.268642],
                                             [58.473842, 31.273024999999997], [58.471084, 31.270069999999997],
                                             [58.472047999999994, 31.277006], [58.481327, 31.281781],
                                             [58.48674, 31.291182], [58.492202, 31.293001],
                                             [58.491375999999995, 31.301136999999997],
                                             [58.497657999999994, 31.297888999999998],
                                             [58.497522999999994, 31.294272999999997], [58.503467, 31.294009],
                                             [58.509164, 31.310447], [58.507697, 31.319481999999997],
                                             [58.513326, 31.327866], [58.516529999999996, 31.340063999999998],
                                             [58.52547, 31.331569], [58.533122999999996, 31.340377],
                                             [58.533485999999996, 31.326715999999998],
                                             [58.537079999999996, 31.328495999999998],
                                             [58.539820999999996, 31.324341999999998], [58.557685, 31.327403999999998],
                                             [58.562234999999994, 31.320159999999998], [58.563922999999996, 31.312678],
                                             [58.569131, 31.316336], [58.567403999999996, 31.344063],
                                             [58.57228, 31.342485], [58.573882, 31.348057999999998],
                                             [58.583059, 31.342793], [58.584365999999996, 31.345086],
                                             [58.592492, 31.394766999999998], [58.599239, 31.412501],
                                             [58.612727, 31.407251], [58.623943, 31.413929999999997],
                                             [58.627792, 31.422242999999998], [58.631029999999996, 31.421115999999998],
                                             [58.629304, 31.416923999999998], [58.631077999999995, 31.414299999999997],
                                             [58.626877, 31.40889], [58.636488, 31.401719999999997],
                                             [58.639322, 31.393642999999997], [58.645368, 31.399697999999997],
                                             [58.650749999999995, 31.386329], [58.642410999999996, 31.378213],
                                             [58.643935, 31.372455], [58.638828999999994, 31.367742999999997],
                                             [58.640480999999994, 31.362333999999997], [58.636098999999994, 31.357643],
                                             [58.63122, 31.366819999999997], [58.613284, 31.35482],
                                             [58.611931999999996, 31.356796], [58.612829, 31.362306],
                                             [58.608200999999994, 31.376209], [58.60622, 31.373413999999997],
                                             [58.603054, 31.377921999999998], [58.605751, 31.385773999999998],
                                             [58.603102, 31.388744], [58.605914999999996, 31.392369],
                                             [58.600167, 31.404536999999998], [58.59442, 31.392875999999998],
                                             [58.594136999999996, 31.382337999999997], [58.589335999999996, 31.365845],
                                             [58.591542, 31.358621999999997], [58.589071, 31.350331999999998],
                                             [58.592127999999995, 31.347029], [58.587052, 31.335193],
                                             [58.587469, 31.326375], [58.590492999999995, 31.321586],
                                             [58.588604, 31.318672], [58.589608999999996, 31.313965999999997],
                                             [58.577647, 31.297884], [58.579507, 31.290083],
                                             [58.587427999999996, 31.286305], [58.590092999999996, 31.263579999999997],
                                             [58.599261999999996, 31.257196999999998],
                                             [58.619170999999994, 31.272544999999997], [58.61814, 31.280078],
                                             [58.624105, 31.283756999999998], [58.630537, 31.25638],
                                             [58.630266999999996, 31.250847999999998], [58.632937999999996, 31.248444],
                                             [58.634726, 31.255969], [58.637753999999994, 31.252238],
                                             [58.636514999999996, 31.246104], [58.640845, 31.242455999999997],
                                             [58.633648, 31.209159999999997], [58.623723, 31.212868999999998],
                                             [58.621727, 31.205938999999997], [58.579102999999996, 31.241781],
                                             [58.572576999999995, 31.238626], [58.568768999999996, 31.241445],
                                             [58.562059999999995, 31.234209], [58.559399, 31.244443999999998],
                                             [58.555943, 31.245195], [58.550801, 31.240208],
                                             [58.554604999999995, 31.226512999999997], [58.553061, 31.226793999999998],
                                             [58.551990999999994, 31.221728], [58.545807999999994, 31.215138999999997],
                                             [58.537499999999994, 31.215373999999997], [58.536538, 31.198348]]]])


    return response.JsonResponse({'complete_ob_list': ob_list, 'complete_projects_count': complete_projects_count, 'complete_r_id': request.GET.get('r_id'), 'complete_c_id': request.GET.get('c_id') })


@csrf_exempt
def Project_addView(request):
    projects_list = {}
    p_list = {}
    p_adr_list = {}
    mark_list = {}
    html = None
    proj=None
    if request.method == 'GET':
        print(request.GET.get('p_id'))
        proj_q = Project.objects.get(id=request.GET.get('p_id'))
        proj = {}
        proj_list = [('p_id', proj_q.id), ('title', proj_q.title), ('adress', proj_q.adress), ('marker', proj_q.marker),
                     ('color', proj_q.category.color), ('r_coords', proj_q.rayon.coords)]
        p_list.update(proj_list)
        proj.update({'project': p_list})
        context = {
            'proj': proj_q
        }
        html = render_to_string('partials/modal_content.html', context)

    return response.JsonResponse({'project_content': html, 'p_list': proj})


FORMS = [
    ("fromform", FromTravelingForm),
    ("toform", ToTravelingForm)
]

TEMPLATES = {
    "fromform"   :   "fromform.html",
    "toform"  :   "toform.html"
}

class AddAnswerWizard(SessionWizardView):

    def get(self, request, *args, **kwargs):
        """
        This method handles GET requests.
        If a GET request reaches this point, the wizard assumes that the user
        just starts at the first step or wants to restart the process.
        The data of the wizard will be resetted before rendering the first step
        """
        self.storage.reset()

        # reset the current step to the first step.
        self.storage.current_step = self.steps.first
        return self.render(self.get_form())

    def get_template_names(self):
        return [TEMPLATES[self.steps.current]]

    def get_context_data(self, form, **kwargs):
        context = super(AddAnswerWizard, self).get_context_data(form=form, **kwargs)
        if self.steps.current == 'fromform':
            context.update({'ok': 'True'})
        return context

    def done(self, form_list, **kwargs):
        ob_list = {}
        fromform = list(form_list)[0].cleaned_data
        toform = list(form_list)[1].cleaned_data
        #folk_objects = Project.objects.filter(rubrics__contains=fromform[''])
        #answer_model.phone = toform['phone']
        for i in Project.objects.all():
            proj = {}
            proj_list = [('p_id', i.id), ('title', i.title), ('adress', i.adress), ('marker1', i.marker1 ), ('marker2', i.marker2 ),
                         ('color', i.category.color)]
            proj.update(proj_list)
            ob_list.update({i.id: proj})
        context = {
            'from_obj': fromform['from_t'],
            'projects': Project.objects.all(),
            'rout': Rubric.objects.filter(slug__in=toform['answer']).first()
        }
        html = render_to_string('rout.html', context)
        return  response.JsonResponse({'ok': 'ok', 'project_content': html, "map_objects": ob_list})


def index(request):
    return render(request, "confirm.html")

